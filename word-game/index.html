<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Alphabet Game</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
  #question { font-size: 28px; margin: 20px; font-weight: bold; }
  #answer { font-size: 20px; padding: 5px; }
  #feedback { font-size: 20px; margin: 10px; height: 30px; }
  .correct { color: green; font-weight: bold; }
  .wrong { color: red; font-weight: bold; }
  .info { margin: 10px; font-size: 18px; }
  select { font-size: 18px; padding: 5px; margin: 10px; }
</style>
</head>
<body>

<h2>Alphabet Game</h2>

<label>Mode: 
  <select id="mode">
    <option value="MIX">Mix</option>
    <option value="L2P">Alphabet → Position</option>
    <option value="P2L">Position → Alphabet</option>
    <option value="P2LR">Position → Alphabet Reverse</option>
    <option value="ADD">Addition / Subtraction</option>
  </select>
</label>

<div id="timer" class="info">Time: 59</div>
<div id="score" class="info">Score: 0</div>
<div id="highscore" class="info">High Score: 0</div>

<div id="question"></div>
<input type="text" id="answer" autocomplete="off" placeholder="Type answer...">
<div id="feedback"></div>

<script>
const qEl = document.getElementById("question");
const aEl = document.getElementById("answer");
const feedback = document.getElementById("feedback");
const scoreEl = document.getElementById("score");
const highEl = document.getElementById("highscore");
const timerEl = document.getElementById("timer");
const modeSel = document.getElementById("mode");

let state = { mode: "MIX", current: {}, score: 0, timer: 59, tId: null };
let highscores = JSON.parse(localStorage.getItem("alphaHighscores") || "{}");

function posToLetter(p){ return String.fromCharCode(64 + ((p-1)%26)+1); }
function letterToPos(l){ return l.toUpperCase().charCodeAt(0)-64; }

function nextQuestion(){
  let mode = state.mode;
  if(mode==="MIX"){
    const modes = ["L2P","P2L","P2LR","ADD"];
    mode = modes[Math.floor(Math.random()*modes.length)];
  }
  let q, expect;

  if(mode==="L2P"){
    const letter = posToLetter(Math.floor(Math.random()*26)+1);
    q = `What is the position of '${letter}'?`;
    expect = letterToPos(letter).toString();
  }
  else if(mode==="P2L"){
    const pos = Math.floor(Math.random()*26)+1;
    q = `Which letter is at position ${pos}?`;
    expect = posToLetter(pos).toUpperCase();
  }
  else if(mode==="P2LR"){
    const pos = Math.floor(Math.random()*26)+1;
    q = `Which letter is at reverse position ${pos}? (Z=1)`;
    expect = posToLetter(27-pos).toUpperCase();
  }
  else if(mode==="ADD"){
    if(Math.random()<0.5){ // letter + number or subtraction
      let letter = posToLetter(Math.floor(Math.random()*26)+1);
      let shift = Math.floor(Math.random()*25)+1;
      if(Math.random()<0.5){
        q = `${letter} + ${shift} = ?`;
        let pos = (letterToPos(letter)+shift-1)%26+1;
        expect = posToLetter(pos).toUpperCase();
      } else {
        let pos = letterToPos(letter);
        if(pos<=shift) pos += 26;
        q = `${letter} - ${shift} = ?`;
        expect = posToLetter(pos-shift).toUpperCase();
      }
    } else { // letter ± letter
      let l1 = posToLetter(Math.floor(Math.random()*26)+1);
      let l2 = posToLetter(Math.floor(Math.random()*26)+1);
      let p1 = letterToPos(l1), p2 = letterToPos(l2);
      if(p1 < p2) [l1,l2,p1,p2] = [l2,l1,p2,p1]; // bigger first
      if(Math.random()<0.5){
        q = `${l1} + ${l2} = ?`;
        expect = posToLetter((p1+p2-1)%26+1).toUpperCase();
      } else {
        q = `${l1} - ${l2} = ?`;
        expect = posToLetter(p1-p2+1).toUpperCase();
      }
    }
  }

  state.current = { expect };
  qEl.textContent = q;
  aEl.value = "";
  aEl.focus();
  feedback.textContent = "";
}

function checkAnswer(){
  let ans = aEl.value.trim().toUpperCase();
  if(ans === state.current.expect){
    state.score++;
    scoreEl.textContent = "Score: "+state.score;
    feedback.textContent = "✅ Correct!";
    feedback.className = "correct";
    setTimeout(nextQuestion, 600);
  } else {
    feedback.textContent = "❌ Wrong!";
    feedback.className = "wrong";
  }
}

function startTimer(){
  clearInterval(state.tId);
  state.timer = 59;
  timerEl.textContent = "Time: "+state.timer;
  state.tId = setInterval(()=>{
    state.timer--;
    timerEl.textContent = "Time: "+state.timer;
    if(state.timer<=0){
      clearInterval(state.tId);
      endGame();
    }
  },1000);
}

function endGame(){
  let mode = state.mode;
  if(mode==="MIX") mode="MIX";
  if(!highscores[mode] || state.score>highscores[mode]){
    highscores[mode]=state.score;
    localStorage.setItem("alphaHighscores", JSON.stringify(highscores));
  }
  alert("Time's up! Your Score: "+state.score);
  updateHighscore();
}

function updateHighscore(){
  let hs = highscores[state.mode]||0;
  highEl.textContent = "High Score: "+hs;
}

aEl.addEventListener("keydown", e=>{
  if(e.key==="Enter") checkAnswer();
});

modeSel.addEventListener("change", ()=>{
  state.mode = modeSel.value;
  state.score = 0;
  scoreEl.textContent="Score: 0";
  updateHighscore();
  startTimer();
  nextQuestion();
});

function startGame(){
  state.mode = "MIX";
  modeSel.value = "MIX";
  state.score = 0;
  scoreEl.textContent="Score: 0";
  updateHighscore();
  startTimer();
  nextQuestion();
}

startGame();
</script>
</body>
</html>